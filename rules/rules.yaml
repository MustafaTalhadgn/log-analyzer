rules :
# # örnek log:Jan 20 14:00:01 server sshd[1234]: Failed password for mustafa from 192.168.1.50 port 22 ssh2
# AUTH LOG Rules

- id: AUTH-001-FAST
  description: "SSH yanlış parola denemesi"
  log_type: auth
  match:
    type: keyword
    value: "Failed password"
  extract:
    ip_regex: "from ([0-9.]+)"
    user_regex: "for (invalid user )?([a-zA-Z0-9_-]+)"
  threshold:
    count: 5
    within_seconds: 60
  severity: CRITICAL
  alert_message: "SSH brute force denemesi tespit edildi"

- id: AUTH-001-SLOW
  description: "SSH yanlış parola denemesi"
  log_type: auth
  match:
    type: keyword
    value: "Failed password"
  extract:
    ip_regex: "from ([0-9.]+)"
    user_regex: "for (invalid user )?([a-zA-Z0-9_-]+)"
  threshold:
    count: 20
    within_seconds: 3600
  severity: CRITICAL
  alert_message: "SSH brute force denemesi tespit edildi"

- id: AUTH-0001-GLOBAL
  description: "SSH yanlış parola denemesi (botnet)"
  log_type: auth
  match:
    type: keyword
    value: "Failed password"
  threshold:
    count: 100         
    within_seconds: 60 
  severity: CRITICAL
  alert_message: "Botnet Saldırısı Şüphesi:Sistem genelinde yoğun saldırı tespit edildi! "

- id: AUTH-002-SLOW
  description: "Geçersiz kullanıcı ile SSH denemesi"
  log_type: auth
  match:
    type: keyword
    value: "invalid user"
  extract:
    ip_regex: "from ([0-9.]+)"
  threshold:
    count: 3
    within_seconds: 120
  severity: WARNING
  alert_message: "Geçersiz kullanıcı adı ile SSH denemeleri"

- id: AUTH-002-FAST
  description: "Geçersiz kullanıcı ile SSH denemesi"
  log_type: auth
  match:
    type: keyword
    value: "invalid user"
  extract:
    ip_regex: "from ([0-9.]+)"
  threshold:
    count: 5
    within_seconds: 60
  severity: CRITICAL
  alert_message: "Geçersiz kullanıcı adı ile SSH denemeleri"

- id: AUTH-002-GLOBAL
  description: "Geçersiz kullanıcı ile SSH denemesi(botnet)"
  log_type: auth
  match:
    type: keyword
    value: "invalid user"
  threshold:
    count: 20
    within_seconds: 60
  severity: CRITICAL
  alert_message: "Botnet Saldırısı Şüphesi: Farklı kaynaklardan yoğun kullanıcı adı denemesi"

- id: AUTH-003-ROOT
  description: "Root kullanıcısı ile başarılı SSH girişi"
  log_type: auth
  match:
    type: keyword
    value: "Accepted password for root"
  extract:
    ip_regex: "from ([0-9.]+)"
  threshold:
    count: 1
    within_seconds: 0
  severity: WARNING
  alert_message: "Root kullanıcısı ile başarılı SSH girişi"


# SYS LOG Rules
- id: SYS-ERROR
  description: "Kritik Sistem Hatası / Kernel Panic"
  log_type: syslog
  match:
    type: regex
    value: "(?i)(kernel panic|segmentation fault|segfault|oom-killer)"
  threshold:
    count: 1
    within_seconds: 0
  severity: CRITICAL
  alert_message: "Kritik sistem hatası tespit edildi"

- id: SYS-ERROR-FLOOD
  description: "Sistem Hata Fırtınası"
  log_type: syslog
  match:
    type: regex
    value: "(?i)error|failed"
  threshold:
    count: 10
    within_seconds: 60
  severity: WARNING
  alert_message: "Sistem hata fırtınası tespit edildi"

# NGINX LOG Rules
- id: NGINX-404-FAST
  description: "Agresif web taraması - Yüksek 404 Sayısı"
  log_type: nginx
  match:
    type: regex
    value: "\\s404\\s"
  extract:
    ip_regex: "^([0-9.]+)"
  threshold:
    count: 10
    within_seconds: 60
  severity: WARNING
  alert_message: "Web sunucusuna agresif tarama yapılıyor (Yüksek 404 Sayısı)"

- id: NGINX-404-SLOW
  description: "Gizli web taraması - Yüksek 404 Sayısı"
  log_type: nginx
  match:
    type: regex
    value: "\\s404\\s"
  extract:
    ip_regex: "^([0-9.]+)"
  threshold:
    count: 20
    within_seconds: 600
  severity: WARNING
  alert_message: "Uzun süreli web tarama aktivitesi tespit edildi (Yüksek 404 Sayısı)"

  
- id: NGINX-CRITICAL-FILE-ACCESS
  description: "Kritik Yapılandırma Dosyası Erişimi (.env / .git)"
  log_type: nginx
  match:
    type: regex
    value: "(/\\.env|/\\.git|/docker-compose|/config\\.php|\\.sql|\\.bak)"
  extract:
    ip_regex: "^([0-9.]+)"
  threshold:
    count: 1
    within_seconds: 0
  severity: CRITICAL
  alert_message: "Kritik yapılandırma dosyasına erişim denemesi tespit edildi"

- id: NGINX-WEB-ATTACK
  description: "Olası Web Saldırısı - SQLi /LFI / XSS Girişimi"
  log_type: nginx
  match:
    type: regex
    value: "(?i)(union.*select|(\\%3C|<)script|\\.\\./|\\.\\.\\%2f|/etc/passwd|1=1|javascript:)"
  extract:
    ip_regex: "^([0-9.]+)"
  threshold:
    count: 1
    within_seconds: 0
  severity: CRITICAL
  alert_message: "Olası web saldırısı tespit edildi (SQLi /LFI / XSS Girişimi)"

- id: NGINX-5XX-FLOOD
  description: "Sunucu Hatası (HTTP 5xx) Tespiti"
  log_type: nginx
  match:
    type: regex
    value: "\\s50[0-9]\\s"
  extract:
    ip_regex: "^([0-9.]+)"
  threshold:
    count: 10
    within_seconds: 60
  severity: CRITICAL
  alert_message: "Web sunucusunda ani artan 5xx hata kodları tespit edildi"

- id: UFW-SSH-ATTACK
  description: "Firewall: Port 22 (SSH) üzerine saldırı tespit edildi"
  log_type: ufw
  match:
    type: regex
    value: "UFW BLOCK.*DPT=22"
  extract:
    ip_regex: "SRC=([0-9.]+)"
    port_regex: "DPT=([0-9]+)"
  threshold:
    count: 5
    within_seconds: 60
  severity: CRITICAL
  alert_message: "Firewall üzerinde SSH portuna yönelik yoğun saldırı tespit edildi"

- id: UFW-PORT-SCAN
  description: "Port tarama (Nmap Taraması) tespit edildi"
  log_type: ufw
  match:
    type: keyword
    value: "UFW BLOCK"
  extract:
    ip_regex: "SRC=([0-9.]+)"
  threshold:
    count: 20
    within_seconds: 60
  severity: WARNING
  alert_message: "Firewall üzerinde port taraması tespit edildi"




